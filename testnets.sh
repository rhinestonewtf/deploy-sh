#!/bin/bash

# Store networks in array if provided, otherwise leave empty
networks=("$@")


while IFS='=' read -r network url; do
    # Skip empty lines and comments
    [[ -z $network || $network == \#* ]] && continue
    # Skip if networks specified and current one not included
    [[ ${#networks[@]} -gt 0 && ! " ${networks[@]} " =~ " ${network} " ]] && continue

    expanded_url=$(echo "$url" | envsubst)

    # Check required addresses
    # Safe Singleton Factory
    code=$(cast code 0x914d7Fec6aaC8cd542e72Bca78B30650d45643d7 --rpc-url "$expanded_url")
    if [ "$code" == "0x" ]; then
        printf '%s\n' "Error: Safe Singleton Factory not deployed" >&2
        exit 1
    fi

    # Mock Attester
    code=$(cast code 0xaed4d8baa80948d54d33de041513d30124e1ae3f --rpc-url "$expanded_url")
    if [ "$code" == "0x" ]; then
        cast send 0x914d7Fec6aaC8cd542e72Bca78B30650d45643d7 0x000000000000000000000000000000000000000000000000000000000000133760a0604052348015600f57600080fd5b506040516112363803806112368339818101604052810190602f91906078565b8015156080811515815250505060a0565b600080fd5b60008115159050919050565b6058816045565b8114606257600080fd5b50565b6000815190506072816051565b92915050565b600060208284031215608b57608a6040565b5b60006097848285016065565b91505092915050565b6080516111516100e56000396000818161051a015281816105440152818161059a015281816105c40152818161061b0152818161067201526106c901526111516000f3fe6080604052600436106100915760003560e01c80638b6e59ff116100595780638b6e59ff146101a0578063cb6ec826146101d0578063cf629cee1461020d578063d58807fe1461023d578063f68f7e1c1461026d57610091565b806301ffc9a71461009657806315c7d4df146100d35780631f1266f91461010357806334c85d07146101335780637949978f14610163575b600080fd5b3480156100a257600080fd5b506100bd60048036038101906100b89190610755565b61029d565b6040516100ca919061079d565b60405180910390f35b6100ed60048036038101906100e89190610882565b61037c565b6040516100fa919061079d565b60405180910390f35b61011d60048036038101906101189190610956565b6103f2565b60405161012a919061079d565b60405180910390f35b61014d600480360381019061014891906109d6565b6104ea565b60405161015a919061079d565b60405180910390f35b34801561016f57600080fd5b5061018a600480360381019061018591906109d6565b610540565b604051610197919061079d565b60405180910390f35b6101ba60048036038101906101b591906109d6565b61056a565b6040516101c7919061079d565b60405180910390f35b3480156101dc57600080fd5b506101f760048036038101906101f29190610a5b565b6105c0565b604051610204919061079d565b60405180910390f35b61022760048036038101906102229190610a5b565b6105eb565b604051610234919061079d565b60405180910390f35b61025760048036038101906102529190610a5b565b610642565b604051610264919061079d565b60405180910390f35b61028760048036038101906102829190610b49565b610699565b604051610294919061079d565b60405180910390f35b60007f53c3e1f4000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061036857507fb2275fa9000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b156103765760019050610377565b5b919050565b60008373ffffffffffffffffffffffffffffffffffffffff1663945e364184846040518363ffffffff1660e01b81526004016103b9929190610f7e565b600060405180830381600087803b1580156103d357600080fd5b505af11580156103e7573d6000803e3d6000fd5b505050509392505050565b600073d1dcdd8e6fe04c338ac3f76f7d7105becab74f7773ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610476576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161046d9061100b565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff16634990a68284846040518363ffffffff1660e01b81526004016104b19291906110f7565b600060405180830381600087803b1580156104cb57600080fd5b505af11580156104df573d6000803e3d6000fd5b505050509392505050565b60007f877db9cc2f850cc572d43a33301191b2fccdcd354359e1314b922bd3b293cdad60405160405180910390a17f00000000000000000000000000000000000000000000000000000000000000009050919050565b60007f00000000000000000000000000000000000000000000000000000000000000009050919050565b60007f8bf74b0dd2927384b1b6dcc25762bb31119ff25165cbcf3b029bc3cac1895dd360405160405180910390a17f00000000000000000000000000000000000000000000000000000000000000009050919050565b60007f0000000000000000000000000000000000000000000000000000000000000000905092915050565b60007f877db9cc2f850cc572d43a33301191b2fccdcd354359e1314b922bd3b293cdad60405160405180910390a17f0000000000000000000000000000000000000000000000000000000000000000905092915050565b60007f8bf74b0dd2927384b1b6dcc25762bb31119ff25165cbcf3b029bc3cac1895dd360405160405180910390a17f0000000000000000000000000000000000000000000000000000000000000000905092915050565b60007f92857d026a245b748b976c8749c4195433e19c476f1d3749eed645c1af01805960405160405180910390a17f0000000000000000000000000000000000000000000000000000000000000000905095945050505050565b600080fd5b600080fd5b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b610732816106fd565b811461073d57600080fd5b50565b60008135905061074f81610729565b92915050565b60006020828403121561076b5761076a6106f3565b5b600061077984828501610740565b91505092915050565b60008115159050919050565b61079781610782565b82525050565b60006020820190506107b2600083018461078e565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006107e3826107b8565b9050919050565b60006107f5826107d8565b9050919050565b610805816107ea565b811461081057600080fd5b50565b600081359050610822816107fc565b92915050565b6000819050919050565b61083b81610828565b811461084657600080fd5b50565b60008135905061085881610832565b92915050565b600080fd5b6000608082840312156108795761087861085e565b5b81905092915050565b60008060006060848603121561089b5761089a6106f3565b5b60006108a986828701610813565b93505060206108ba86828701610849565b925050604084013567ffffffffffffffff8111156108db576108da6106f8565b5b6108e786828701610863565b9150509250925092565b600080fd5b600080fd5b600080fd5b60008083601f840112610916576109156108f1565b5b8235905067ffffffffffffffff811115610933576109326108f6565b5b60208301915083602082028301111561094f5761094e6108fb565b5b9250929050565b60008060006040848603121561096f5761096e6106f3565b5b600061097d86828701610813565b935050602084013567ffffffffffffffff81111561099e5761099d6106f8565b5b6109aa86828701610900565b92509250509250925092565b600061010082840312156109cd576109cc61085e565b5b81905092915050565b600061010082840312156109ed576109ec6106f3565b5b60006109fb848285016109b6565b91505092915050565b60008083601f840112610a1a57610a196108f1565b5b8235905067ffffffffffffffff811115610a3757610a366108f6565b5b60208301915083610100820283011115610a5457610a536108fb565b5b9250929050565b60008060208385031215610a7257610a716106f3565b5b600083013567ffffffffffffffff811115610a9057610a8f6106f8565b5b610a9c85828601610a04565b92509250509250929050565b610ab1816107d8565b8114610abc57600080fd5b50565b600081359050610ace81610aa8565b92915050565b600060608284031215610aea57610ae961085e565b5b81905092915050565b60008083601f840112610b0957610b086108f1565b5b8235905067ffffffffffffffff811115610b2657610b256108f6565b5b602083019150836001820283011115610b4257610b416108fb565b5b9250929050565b600080600080600060808688031215610b6557610b646106f3565b5b6000610b7388828901610abf565b9550506020610b8488828901610abf565b945050604086013567ffffffffffffffff811115610ba557610ba46106f8565b5b610bb188828901610ad4565b935050606086013567ffffffffffffffff811115610bd257610bd16106f8565b5b610bde88828901610af3565b92509250509295509295909350565b6000610bf882610828565b9050919050565b610c0881610bed565b82525050565b6000610c1d6020840184610abf565b905092915050565b610c2e816107d8565b82525050565b600065ffffffffffff82169050919050565b610c4f81610c34565b8114610c5a57600080fd5b50565b600081359050610c6c81610c46565b92915050565b6000610c816020840184610c5d565b905092915050565b610c9281610c34565b82525050565b600080fd5b600080fd5b600080fd5b60008083356001602003843603038112610cc457610cc3610ca2565b5b83810192508235915060208301925067ffffffffffffffff821115610cec57610ceb610c98565b5b600182023603831315610d0257610d01610c9d565b5b509250929050565b600082825260208201905092915050565b82818337600083830152505050565b6000601f19601f8301169050919050565b6000610d478385610d0a565b9350610d54838584610d1b565b610d5d83610d2a565b840190509392505050565b60008083356001602003843603038112610d8557610d84610ca2565b5b83810192508235915060208301925067ffffffffffffffff821115610dad57610dac610c98565b5b602082023603831315610dc357610dc2610c9d565b5b509250929050565b600082825260208201905092915050565b6000819050919050565b6000819050919050565b6000819050919050565b6000610e15610e10610e0b84610de6565b610df0565b610de6565b9050919050565b610e2581610dfa565b82525050565b6000610e378383610e1c565b60208301905092915050565b610e4c81610de6565b8114610e5757600080fd5b50565b600081359050610e6981610e43565b92915050565b6000610e7e6020840184610e5a565b905092915050565b6000602082019050919050565b6000610e9f8385610dcb565b9350610eaa82610ddc565b8060005b85811015610ee357610ec08284610e6f565b610eca8882610e2b565b9750610ed583610e86565b925050600181019050610eae565b5085925050509392505050565b600060808301610f036000840184610c0e565b610f106000860182610c25565b50610f1e6020840184610c72565b610f2b6020860182610c89565b50610f396040840184610ca7565b8583036040870152610f4c838284610d3b565b92505050610f5d6060840184610d68565b8583036060870152610f70838284610e93565b925050508091505092915050565b6000604082019050610f936000830185610bff565b8181036020830152610fa58184610ef0565b90509392505050565b600082825260208201905092915050565b7f4f6e6c79205268696e6573746f6e65207465616d2063616e207265766f6b6500600082015250565b6000610ff5601f83610fae565b915061100082610fbf565b602082019050919050565b6000602082019050818103600083015261102481610fe8565b9050919050565b600082825260208201905092915050565b6000819050919050565b602082016110576000830183610c0e565b6110646000850182610c25565b50505050565b60006110768383611046565b60208301905092915050565b600082905092915050565b6000602082019050919050565b60006110a6838561102b565b93506110b18261103c565b8060005b858110156110ea576110c78284611082565b6110d1888261106a565b97506110dc8361108d565b9250506001810190506110b5565b5085925050509392505050565b6000602082019050818103600083015261111281848661109a565b9050939250505056fea2646970667358221220d61302d317bf23b81970989ccd9aea6c5f0fd7b166cce2a2d609556d8cce762664736f6c634300081900330000000000000000000000000000000000000000000000000000000000000001 --rpc-url "$expanded_url" --private-key "$PRIVATE_KEY"
    fi
    printf '\e]8;;https://contractscan.xyz/contract/0xaed4d8baa80948d54d33de041513d30124e1ae3f\e\\Mock Attester successfully deployed\e]8;;\e\\\n'

done < <(curl -s https://raw.githubusercontent.com/rhinestonewtf/constants/refs/heads/main/networks.txt)
